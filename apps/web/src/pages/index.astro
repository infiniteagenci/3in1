---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro'
---

<Layout title="3in1 - Your Faith Community, Always With You">
  <slot name="head">
    <meta name="description" content="3in1 - A welcoming Catholic spiritual community where you chat with Spirit, explore sacred texts, pray together, and grow in faith with friends on the same journey." />
  </slot>

  <!-- Allow scrolling on index page -->
  <style>
    html, body {
      overflow: auto !important;
      height: auto !important;
    }

    /* Custom Animations */
    @keyframes pulse-slow {
      0%, 100% { opacity: 0.6; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.05); }
    }

    @keyframes float {
      0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
      50% { transform: translate(-50%, -50%) rotate(180deg); }
    }

    @keyframes float-slow {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-10px) rotate(5deg); }
    }

    @keyframes fade-in-up {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .animate-pulse-slow { animation: pulse-slow 4s ease-in-out infinite; }
    .animate-float { animation: float 20s linear infinite; }
    .animate-float-slow { animation: float-slow 3s ease-in-out infinite; }
    .animate-fade-in-up { animation: fade-in-up 0.8s ease-out forwards; opacity: 0; }
  </style>

  <!-- Hero Section with Vibrant Purple Gradient Background (matching login) -->
  <section class="relative min-h-[90vh] flex items-center justify-center overflow-hidden" style="background: linear-gradient(135deg, #C84B9F 0%, #8B5FCF 50%, #D870B7 100%);">
    <!-- Hidden Google Translate Element -->
    <div id="google_translate_element" class="hidden"></div>

    <!-- Animated Background Elements -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
      <div class="absolute top-20 left-10 w-72 h-72 bg-gradient-to-br from-purple-300/40 to-violet-300/40 rounded-full blur-3xl animate-pulse-slow"></div>
      <div class="absolute bottom-20 right-10 w-96 h-96 bg-gradient-to-br from-fuchsia-300/40 to-pink-300/40 rounded-full blur-3xl animate-pulse-slow" style="animation-delay: 1s;"></div>
      <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-gradient-to-br from-purple-200/30 to-violet-200/30 rounded-full blur-3xl animate-float"></div>
    </div>

    <!-- Navigation -->
    <nav class="absolute top-0 left-0 right-0 z-20 px-6 py-4">
      <div class="max-w-6xl mx-auto flex items-center justify-between">
        <!-- Logo -->
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center shadow-lg border border-white/30">
            <span class="text-white font-bold text-xl font-geist">3</span>
          </div>
          <span class="font-playfair text-2xl font-semibold text-white">3in1</span>
        </div>

        <!-- Language Selector -->
        <div class="relative" id="language-selector-container">
          <button
            id="language-button"
            class="flex items-center gap-2 px-4 py-2 bg-white/20 hover:bg-white/30 backdrop-blur-sm rounded-full transition-all text-white"
          >
            <span class="text-lg">üåê</span>
            <span class="text-sm font-medium" id="current-language-name">English</span>
            <svg class="w-4 h-4 transition-transform" id="language-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div
            id="language-dropdown"
            class="hidden absolute top-full right-0 mt-2 w-56 bg-white rounded-xl shadow-xl border border-gray-200 z-50 max-h-80 overflow-y-auto"
          >
            <div class="p-2 space-y-1" id="language-options">
              <!-- Language options will be populated by JavaScript -->
            </div>
          </div>
        </div>

        <!-- Auth Buttons -->
        <div id="nav-logged-out" class="flex items-center gap-4">
          <a href="/login" class="px-5 py-2.5 text-white/90 hover:text-white transition-colors font-geist font-medium">Login</a>
          <a href="/login" class="px-6 py-2.5 bg-white text-purple-600 rounded-full font-geist font-medium hover:shadow-lg hover:scale-105 transition-all duration-200">Join Community</a>
        </div>
        <div id="nav-logged-in" class="hidden flex items-center gap-4">
          <a href="/chat" class="px-6 py-2.5 bg-white text-purple-600 rounded-full font-geist font-medium hover:shadow-lg hover:scale-105 transition-all duration-200">Continue Your Journey</a>
          <button id="nav-logout-link" class="px-5 py-2.5 text-white/90 hover:text-white transition-colors font-geist font-medium">Logout</button>
        </div>
      </div>
    </nav>

    <!-- Hero Content -->
    <div class="relative z-10 max-w-5xl mx-auto px-6 text-center pt-20">
      <!-- Welcome Badge -->
      <div class="inline-flex items-center gap-2 px-4 py-2 bg-white/20 backdrop-blur-sm rounded-full mb-8 shadow-sm animate-fade-in-up">
        <span class="text-lg">‚ú®</span>
        <span class="text-sm font-geist text-white">Your faith community, always with you</span>
      </div>

      <!-- Main Heading -->
      <h1 class="font-playfair text-5xl sm:text-6xl lg:text-7xl font-semibold text-white leading-tight mb-6 animate-fade-in-up" style="animation-delay: 0.1s;">
        Find <span class="text-transparent bg-clip-text bg-gradient-to-r from-white to-purple-100 italic font-crimson">Peace</span> in <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-100 to-pink-100 italic font-crimson">Community</span>
      </h1>

      <!-- Subheading -->
      <p class="font-geist text-lg sm:text-xl text-white/90 max-w-2xl mx-auto mb-10 leading-relaxed animate-fade-in-up" style="animation-delay: 0.2s;">
        Connect with Spirit for guidance, explore sacred texts, pray with others, and grow in faith alongside a warm, supportive community.
      </p>

      <!-- Logged Out CTA -->
      <div id="logged-out-content" class="animate-fade-in-up" style="animation-delay: 0.3s;">
        <a href="/login" class="inline-flex items-center gap-3 px-8 py-4 bg-white text-purple-600 rounded-full font-geist font-semibold text-lg hover:shadow-xl hover:scale-105 transition-all duration-200">
          <span>Start Your Journey</span>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
          </svg>
        </a>
        <p class="mt-4 text-sm text-white/70 font-geist">Free to join ‚Ä¢ No credit card required</p>
      </div>

      <!-- Logged In CTA -->
      <div id="logged-in-content" class="hidden animate-fade-in-up" style="animation-delay: 0.3s;">
        <a href="/chat" class="inline-flex items-center gap-3 px-8 py-4 bg-white text-purple-600 rounded-full font-geist font-semibold text-lg hover:shadow-xl hover:scale-105 transition-all duration-200">
          <span>Continue Your Journey</span>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
          </svg>
        </a>
      </div>
    </div>

    <!-- Scroll Indicator -->
    <div class="absolute bottom-8 left-1/2 -translate-x-1/2 animate-bounce">
      <svg class="w-6 h-6 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
      </svg>
    </div>
  </section>

  <!-- Features Section -->
  <section class="py-24 px-6 bg-white">
    <div class="max-w-6xl mx-auto">
      <!-- Section Header -->
      <div class="text-center mb-16">
        <span class="inline-block px-4 py-1.5 bg-purple-50 text-purple-600 rounded-full text-sm font-geist font-medium mb-4">Everything You Need</span>
        <h2 class="font-playfair text-4xl sm:text-5xl font-semibold text-gray-900 mb-6">Grow Your Faith, Together</h2>
        <p class="font-geist text-lg text-gray-600 max-w-2xl mx-auto">All the tools and support you need for your spiritual journey, in one welcoming place.</p>
      </div>

      <!-- Features Grid -->
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Feature 1 -->
        <div class="group p-6 rounded-3xl bg-gradient-to-br from-purple-50 to-violet-50 hover:from-purple-100 hover:to-violet-100 transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
          <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-400 to-violet-500 flex items-center justify-center mb-4 shadow-md group-hover:scale-110 transition-transform duration-300">
            <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
            </svg>
          </div>
          <h3 class="font-geist font-semibold text-xl text-gray-900 mb-2">Chat with Spirit</h3>
          <p class="font-geist text-gray-600 leading-relaxed">A warm, understanding guide who remembers your journey and offers personalized wisdom.</p>
        </div>

        <!-- Feature 2 -->
        <div class="group p-6 rounded-3xl bg-gradient-to-br from-fuchsia-50 to-pink-50 hover:from-fuchsia-100 hover:to-pink-100 transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
          <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-fuchsia-400 to-pink-500 flex items-center justify-center mb-4 shadow-md group-hover:scale-110 transition-transform duration-300">
            <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
            </svg>
          </div>
          <h3 class="font-geist font-semibold text-xl text-gray-900 mb-2">Sacred Library</h3>
          <p class="font-geist text-gray-600 leading-relaxed">Explore the Bible, Catechism, and inspiring writings from the Saints.</p>
        </div>

        <!-- Feature 3 -->
        <div class="group p-6 rounded-3xl bg-gradient-to-br from-violet-50 to-indigo-50 hover:from-violet-100 hover:to-indigo-100 transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
          <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-violet-400 to-indigo-500 flex items-center justify-center mb-4 shadow-md group-hover:scale-110 transition-transform duration-300">
            <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
            </svg>
          </div>
          <h3 class="font-geist font-semibold text-xl text-gray-900 mb-2">Pray Together</h3>
          <p class="font-geist text-gray-600 leading-relaxed">Join others in prayer, find peace in shared worship, and grow spiritually.</p>
        </div>

        <!-- Feature 4 -->
        <div class="group p-6 rounded-3xl bg-gradient-to-br from-purple-50 to-violet-50 hover:from-purple-100 hover:to-violet-100 transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
          <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-400 to-violet-500 flex items-center justify-center mb-4 shadow-md group-hover:scale-110 transition-transform duration-300">
            <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
            </svg>
          </div>
          <h3 class="font-geist font-semibold text-xl text-gray-900 mb-2">Daily Progress</h3>
          <p class="font-geist text-gray-600 leading-relaxed">Track your spiritual growth with daily check-ins and personalized insights.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Community Section -->
  <section class="py-24 px-6 bg-gradient-to-br from-purple-50/80 via-violet-50/80 to-fuchsia-50/80">
    <div class="max-w-6xl mx-auto">
      <div class="grid lg:grid-cols-2 gap-12 items-center">
        <!-- Content -->
        <div>
          <span class="inline-block px-4 py-1.5 bg-purple-50 text-purple-600 rounded-full text-sm font-geist font-medium mb-4">Community</span>
          <h2 class="font-playfair text-4xl sm:text-5xl font-semibold text-gray-900 mb-6">Never Walk Alone</h2>
          <p class="font-geist text-lg text-gray-600 mb-8 leading-relaxed">
            Faith is better together. Join thousands of believers who find strength, encouragement, and wisdom in our supportive community.
          </p>

          <!-- Community Stats -->
          <div class="grid grid-cols-3 gap-6 mb-8">
            <div class="text-center">
              <div class="font-geist text-3xl font-bold text-purple-500">24/7</div>
              <div class="font-geist text-sm text-gray-600">Always Available</div>
            </div>
            <div class="text-center">
              <div class="font-geist text-3xl font-bold text-fuchsia-500">100%</div>
              <div class="font-geist text-sm text-gray-600">Catholic Teaching</div>
            </div>
            <div class="text-center">
              <div class="font-geist text-3xl font-bold text-violet-500">Free</div>
              <div class="font-geist text-sm text-gray-600">For Everyone</div>
            </div>
          </div>

          <a href="/login" class="inline-flex items-center gap-2 px-6 py-3 bg-white text-purple-600 rounded-full font-geist font-medium hover:shadow-lg transition-all duration-200">
            Join Our Community
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
            </svg>
          </a>
        </div>

        <!-- Visual -->
        <div class="relative">
          <div class="aspect-square rounded-3xl bg-gradient-to-br from-purple-300 to-violet-400 p-1">
            <div class="w-full h-full rounded-3xl bg-white flex items-center justify-center">
              <div class="text-center p-8">
                <div class="text-6xl mb-4">üôè</div>
                <p class="font-playfair text-2xl text-gray-800 mb-2">"Where two or three are gathered..."</p>
                <p class="font-geist text-gray-600">Matthew 18:20</p>
              </div>
            </div>
          </div>

          <!-- Floating Elements -->
          <div class="absolute -top-4 -right-4 w-20 h-20 rounded-2xl bg-gradient-to-br from-fuchsia-300 to-pink-400 flex items-center justify-center text-white text-3xl shadow-lg animate-float-slow">
            üíí
          </div>
          <div class="absolute -bottom-4 -left-4 w-16 h-16 rounded-2xl bg-gradient-to-br from-violet-300 to-indigo-400 flex items-center justify-center text-white text-2xl shadow-lg animate-float-slow" style="animation-delay: 1s;">
            ‚ú®
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- How It Works -->
  <section class="py-24 px-6 bg-white">
    <div class="max-w-6xl mx-auto">
      <div class="text-center mb-16">
        <span class="inline-block px-4 py-1.5 bg-purple-50 text-purple-600 rounded-full text-sm font-geist font-medium mb-4">Simple Steps</span>
        <h2 class="font-playfair text-4xl sm:text-5xl font-semibold text-gray-900 mb-6">Start Your Journey Today</h2>
      </div>

      <div class="grid md:grid-cols-3 gap-8">
        <!-- Step 1 -->
        <div class="relative text-center">
          <div class="w-16 h-16 rounded-full bg-gradient-to-br from-purple-400 to-violet-500 text-white flex items-center justify-center font-geist text-2xl font-bold mx-auto mb-6 shadow-lg">1</div>
          <h3 class="font-geist font-semibold text-xl text-gray-900 mb-3">Create Your Profile</h3>
          <p class="font-geist text-gray-600">Sign up in seconds with Google. Tell us about yourself so Spirit can personalize your experience.</p>
          <div class="hidden md:block absolute top-8 right-0 w-1/2 h-0.5 bg-gradient-to-r from-purple-200 to-transparent"></div>
        </div>

        <!-- Step 2 -->
        <div class="relative text-center">
          <div class="w-16 h-16 rounded-full bg-gradient-to-br from-fuchsia-400 to-pink-500 text-white flex items-center justify-center font-geist text-2xl font-bold mx-auto mb-6 shadow-lg">2</div>
          <h3 class="font-geist font-semibold text-xl text-gray-900 mb-3">Connect & Explore</h3>
          <p class="font-geist text-gray-600">Chat with Spirit, explore the Sacred Library, and discover prayers that speak to your heart.</p>
          <div class="hidden md:block absolute top-8 right-0 w-1/2 h-0.5 bg-gradient-to-r from-fuchsia-200 to-transparent"></div>
        </div>

        <!-- Step 3 -->
        <div class="text-center">
          <div class="w-16 h-16 rounded-full bg-gradient-to-br from-violet-400 to-indigo-500 text-white flex items-center justify-center font-geist text-2xl font-bold mx-auto mb-6 shadow-lg">3</div>
          <h3 class="font-geist font-semibold text-xl text-gray-900 mb-3">Grow Daily</h3>
          <p class="font-geist text-gray-600">Build habits, track your progress, and watch your faith deepen with each conversation.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Testimonial/Social Proof -->
  <section class="py-24 px-6 bg-gradient-to-br from-gray-50 to-gray-100">
    <div class="max-w-4xl mx-auto text-center">
      <div class="text-6xl mb-6">üôå</div>
      <blockquote class="font-playfair text-2xl sm:text-3xl text-gray-800 leading-relaxed mb-6 italic">
        "Having Spirit in my pocket has transformed my daily prayer life. It's like having a wise friend who always points me toward Christ."
      </blockquote>
      <cite class="font-geist text-gray-600 not-italic">‚Äî Community Member</cite>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="py-24 px-6 bg-gradient-to-br from-purple-400 to-violet-500">
    <div class="max-w-4xl mx-auto text-center text-white">
      <h2 class="font-playfair text-4xl sm:text-5xl font-semibold mb-6">Ready to Grow in Faith?</h2>
      <p class="font-geist text-xl opacity-90 mb-10 max-w-2xl mx-auto">Join thousands of believers who are deepening their relationship with God through our welcoming community.</p>

      <div id="cta-logged-out">
        <a href="/login" class="inline-flex items-center gap-3 px-10 py-5 bg-white text-purple-600 rounded-full font-geist font-semibold text-lg hover:shadow-2xl hover:scale-105 transition-all duration-200">
          <span>Join 3in1 Today</span>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
          </svg>
        </a>
      </div>

      <div id="cta-logged-in" class="hidden">
        <a href="/chat" class="inline-flex items-center gap-3 px-10 py-5 bg-white text-purple-600 rounded-full font-geist font-semibold text-lg hover:shadow-2xl hover:scale-105 transition-all duration-200">
          <span>Continue Your Journey</span>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
          </svg>
        </a>
      </div>

      <p class="mt-6 text-sm opacity-80 font-geist">Free forever ‚Ä¢ No credit card required ‚Ä¢ Cancel anytime</p>
    </div>
  </section>

  <!-- Footer -->
  <footer class="py-12 px-6 bg-gray-900 text-gray-400">
    <div class="max-w-6xl mx-auto">
      <div class="flex flex-col md:flex-row items-center justify-between gap-6">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-purple-400 to-violet-500 flex items-center justify-center">
            <span class="text-white font-bold font-geist">3</span>
          </div>
          <span class="font-playfair text-xl text-white">3in1</span>
        </div>
        <p class="font-geist text-sm text-center md:text-right">
          By using 3in1, you agree to our <a href="#" class="text-purple-300 hover:text-purple-200 transition-colors">Privacy Policy</a> and <a href="#" class="text-purple-300 hover:text-purple-200 transition-colors">Service Terms</a>.
        </p>
      </div>
    </div>
  </footer>

  <script>
    // Set API URL based on current environment
    const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    const PUBLIC_WORKER_API_URL = isLocalhost
      ? 'http://localhost:8787'
      : 'https://3in1-worker.ailabs-hq.workers.dev';

    // DOM elements
    const loggedOutContent = document.getElementById('logged-out-content');
    const loggedInContent = document.getElementById('logged-in-content');
    const navLoggedOut = document.getElementById('nav-logged-out');
    const navLoggedIn = document.getElementById('nav-logged-in');
    const ctaLoggedOut = document.getElementById('cta-logged-out');
    const ctaLoggedIn = document.getElementById('cta-logged-in');
    const navLogoutLink = document.getElementById('nav-logout-link');

    // Function to add hidden class
    function hideElement(el) {
      el.classList.add('hidden');
    }

    // Function to remove hidden class
    function showElement(el) {
      el.classList.remove('hidden');
    }

    // Function to check session
    async function checkSession() {
      try {
        const token = localStorage.getItem('session_token');
        if (!token) {
          // Show logged out content
          showElement(loggedOutContent);
          hideElement(loggedInContent);
          showElement(navLoggedOut);
          hideElement(navLoggedIn);
          showElement(ctaLoggedOut);
          hideElement(ctaLoggedIn);
          return;
        }

        const response = await fetch(PUBLIC_WORKER_API_URL + '/auth/validate', {
          headers: {
            'Authorization': 'Bearer ' + token
          }
        });

        if (response.ok) {
          // Show logged in content
          hideElement(loggedOutContent);
          showElement(loggedInContent);
          hideElement(navLoggedOut);
          showElement(navLoggedIn);
          hideElement(ctaLoggedOut);
          showElement(ctaLoggedIn);
        } else {
          // Session invalid, clear token
          localStorage.removeItem('session_token');
          // Show logged out content
          showElement(loggedOutContent);
          hideElement(loggedInContent);
          showElement(navLoggedOut);
          hideElement(navLoggedIn);
          showElement(ctaLoggedOut);
          hideElement(ctaLoggedIn);
        }
      } catch (error) {
        console.error('Error checking session:', error);
        // On error, show logged out content
        localStorage.removeItem('session_token');
        showElement(loggedOutContent);
        hideElement(loggedInContent);
        showElement(navLoggedOut);
        hideElement(navLoggedIn);
        showElement(ctaLoggedOut);
        hideElement(ctaLoggedIn);
      }
    }

    // Function to handle logout
    async function handleLogout() {
      try {
        const token = localStorage.getItem('session_token');
        if (token) {
          await fetch(PUBLIC_WORKER_API_URL + '/auth/logout', {
            method: 'POST',
            headers: {
              'Authorization': 'Bearer ' + token,
              'Content-Type': 'application/json'
            }
          });
        }

        localStorage.removeItem('session_token');
        // Update UI to logged out state
        showElement(loggedOutContent);
        hideElement(loggedInContent);
        showElement(navLoggedOut);
        hideElement(navLoggedIn);
        showElement(ctaLoggedOut);
        hideElement(ctaLoggedIn);
      } catch (error) {
        console.error('Error logging out:', error);
      }
    }

    // Add event listeners to logout elements
    navLogoutLink.addEventListener('click', function(e) {
      e.preventDefault();
      handleLogout();
    });

    // Check session on page load
    checkSession();

    // ====================
    // Language Selector
    // ====================
    // Google Translate language codes mapping
    const googleTranslateLangCodes = {
      'en': 'en',
      'es': 'es',
      'pt': 'pt',
      'fr': 'fr',
      'de': 'de',
      'it': 'it',
      'pl': 'pl',
      'tl': 'tl',
      'vi': 'vi',
      'ko': 'ko',
      'zh': 'zh-CN',
      'ja': 'ja',
      'ar': 'ar',
      'hi': 'hi',
      'ta': 'ta',
      'te': 'te',
      'kn': 'kn',
      'ks': 'ur', // Kashmiri uses Urdu code for Google Translate
      'la': 'la',
    };

    const languages = [
      { code: 'en', name: 'English', nativeName: 'English' },
      { code: 'es', name: 'Spanish', nativeName: 'Espa√±ol' },
      { code: 'pt', name: 'Portuguese', nativeName: 'Portugu√™s' },
      { code: 'fr', name: 'French', nativeName: 'Fran√ßais' },
      { code: 'de', name: 'German', nativeName: 'Deutsch' },
      { code: 'it', name: 'Italian', nativeName: 'Italiano' },
      { code: 'pl', name: 'Polish', nativeName: 'Polski' },
      { code: 'tl', name: 'Filipino', nativeName: 'Filipino' },
      { code: 'vi', name: 'Vietnamese', nativeName: 'Ti·∫øng Vi·ªát' },
      { code: 'ko', name: 'Korean', nativeName: 'ÌïúÍµ≠Ïñ¥' },
      { code: 'zh', name: 'Chinese', nativeName: '‰∏≠Êñá' },
      { code: 'ja', name: 'Japanese', nativeName: 'Êó•Êú¨Ë™û' },
      { code: 'ar', name: 'Arabic', nativeName: 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©' },
      { code: 'hi', name: 'Hindi', nativeName: '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä' },
      { code: 'ta', name: 'Tamil', nativeName: '‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç' },
      { code: 'te', name: 'Telugu', nativeName: '‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å' },
      { code: 'kn', name: 'Kannada', nativeName: '‡≤ï‡≤®‡≥ç‡≤®‡≤°' },
      { code: 'ks', name: 'Kashmiri', nativeName: '⁄©Ÿ≤ÿ¥Ÿèÿ±' },
      { code: 'la', name: 'Latin', nativeName: 'Latina' },
    ];

    // Load Google Translate
    let googleTranslateLoaded = false;

    function loadGoogleTranslate(callback) {
      if (googleTranslateLoaded) {
        callback();
        return;
      }

      if (window.google && window.google.translate) {
        googleTranslateLoaded = true;
        callback();
        return;
      }

      window.googleTranslateElementInit = function() {
        googleTranslateLoaded = true;
        callback();
      };

      const script = document.createElement('script');
      script.type = 'text/javascript';
      script.src = 'https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit';
      document.head.appendChild(script);
    }

    // Translate page content
    function translatePage(languageCode) {
      const googleLangCode = googleTranslateLangCodes[languageCode] || languageCode;

      if (languageCode === 'en') {
        // Reload page to remove translation
        location.reload();
        return;
      }

      loadGoogleTranslate(function() {
        const translateElement = document.getElementById('google_translate_element');
        if (translateElement && window.google && window.google.translate) {
          try {
            // Clear existing translation
            const existingFrame = translateElement.querySelector('iframe');
            if (existingFrame) {
              existingFrame.remove();
            }

            // Create new translate element
            new google.translate.TranslateElement({
              pageLanguage: 'en',
              includedLanguages: googleLangCode,
              layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
              autoDisplay: false
            }, 'google_translate_element');

            // Trigger translation
            setTimeout(function() {
              const selectElement = document.querySelector('.goog-te-combo');
              if (selectElement) {
                selectElement.value = googleLangCode;
                selectElement.dispatchEvent(new Event('change'));
              }
            }, 500);
          } catch (error) {
            console.error('Translation error:', error);
          }
        }
      });
    }

    // Language selector elements
    const languageButton = document.getElementById('language-button');
    const languageDropdown = document.getElementById('language-dropdown');
    const languageOptions = document.getElementById('language-options');
    const currentLanguageName = document.getElementById('current-language-name');
    const languageArrow = document.getElementById('language-arrow');

    // Get current language from localStorage or default to English
    let currentLanguage = localStorage.getItem('app_language') || 'en';

    // Update language display
    function updateLanguageDisplay() {
      const lang = languages.find(l => l.code === currentLanguage) || languages[0];
      if (currentLanguageName) {
        currentLanguageName.textContent = lang.nativeName;
      }

      // Set lang attribute on html
      document.documentElement.lang = currentLanguage;

      // Store in localStorage
      localStorage.setItem('app_language', currentLanguage);

      // Apply translation
      translatePage(currentLanguage);

      // Trigger custom event for other components
      window.dispatchEvent(new CustomEvent('languageChange', { detail: { language: currentLanguage } }));
    }

    // Initialize language display
    updateLanguageDisplay();

    // Populate language options
    function populateLanguageOptions() {
      if (!languageOptions) return;

      languageOptions.innerHTML = languages.map(lang => `
        <button
          data-lang="${lang.code}"
          class="w-full text-left px-4 py-3 rounded-lg transition-colors flex items-center justify-between ${
            currentLanguage === lang.code
              ? 'bg-purple-50 text-purple-700 font-medium'
              : 'text-gray-700 hover:bg-gray-50'
          }"
        >
          <span class="text-sm">${lang.nativeName}</span>
          <span class="text-xs text-gray-500">(${lang.name})</span>
        </button>
      `).join('');

      // Add event listeners to language options
      languageOptions.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', function() {
          const langCode = this.getAttribute('data-lang');
          if (langCode) {
            currentLanguage = langCode;
            updateLanguageDisplay();
            populateLanguageOptions(); // Refresh to update selection
            toggleLanguageDropdown();
          }
        });
      });
    }

    // Toggle language dropdown
    function toggleLanguageDropdown() {
      if (!languageDropdown || !languageArrow) return;
      languageDropdown.classList.toggle('hidden');
      languageArrow.classList.toggle('rotate-180');
    }

    // Initialize language options
    populateLanguageOptions();

    // Add event listener to language button
    if (languageButton) {
      languageButton.addEventListener('click', toggleLanguageDropdown);
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
      if (languageButton && !languageButton.contains(e.target) && languageDropdown && !languageDropdown.contains(e.target)) {
        languageDropdown.classList.add('hidden');
        if (languageArrow) {
          languageArrow.classList.remove('rotate-180');
        }
      }
    });
  </script>
</Layout>
