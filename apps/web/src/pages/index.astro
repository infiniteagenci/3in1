---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro'
---

<Layout title="3in1 - Spiritual Guidance with Spirit">
  <slot name="head">
    <meta name="description" content="3in1 - A spiritual app where you chat with Spirit, an AI guide who understands Jesus's teachings and provides personalized spiritual guidance." />
  </slot>
    <!-- Navigation Header -->
    <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
      <nav class="container mx-auto px-6 py-4">
        <div class="flex items-center justify-between">
          <!-- Logo -->
          <div class="flex items-center space-x-2">
            <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl flex items-center justify-center">
              <span class="text-white font-bold text-xl">3</span>
            </div>
            <span class="text-xl font-bold text-gray-900">3in1</span>
          </div>

          <!-- Navigation Links -->
          <div id="nav-content">
            <div id="nav-logged-out" class="flex items-center space-x-6">
              <a href="/login" class="text-gray-600 hover:text-gray-900 transition-colors">Login</a>
              <a href="/login" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                Meet Spirit
              </a>
            </div>
            <div id="nav-logged-in" class="hidden flex items-center space-x-6">
              <a href="/chat" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                Chat with Spirit
              </a>
              <button id="nav-logout-link" class="text-gray-600 hover:text-gray-900 transition-colors">
                Logout
              </button>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <!-- Hero Section -->
    <main>
      <section class="container mx-auto px-6 py-20">
        <div class="text-center max-w-4xl mx-auto">
          <div class="inline-flex items-center bg-purple-100 text-purple-800 px-4 py-2 rounded-full text-sm font-medium mb-8">
            <span class="w-2 h-2 bg-purple-400 rounded-full mr-2 animate-pulse"></span>
            Meet Spirit - Your Spiritual Guide
          </div>

          <h1 class="text-5xl md:text-6xl font-bold text-gray-900 mb-6">
            Find Spiritual Guidance
            <span class="block text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-indigo-600">
              Through Jesus's Teachings
            </span>
          </h1>

          <p class="text-xl text-gray-600 mb-10 leading-relaxed">
            Chat with Spirit, an AI guide who deeply understands Jesus's teachings and provides
            personal spiritual guidance. Spirit remembers your conversations and grows to understand
            your unique journey with faith.
          </p>

          <div id="content">
            <!-- Logged out content -->
            <div id="logged-out-content">
              <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
                <a href="/login" class="bg-purple-600 text-white px-8 py-4 rounded-xl font-semibold hover:bg-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg">
                  Chat with Spirit
                </a>
                <button class="bg-white text-gray-700 px-8 py-4 rounded-xl font-semibold hover:bg-gray-50 transition-colors border border-gray-300">
                  Learn More
                </button>
              </div>
            </div>

            <!-- Logged in content -->
            <div id="logged-in-content" class="hidden">
              <h2 id="welcome-text" class="text-3xl font-bold text-gray-900 mb-4">Welcome back!</h2>
              <p class="text-lg text-gray-600 mb-8">Spirit is ready to continue guiding you on your spiritual journey.</p>
              <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
                <a href="/chat" class="bg-purple-600 text-white px-8 py-4 rounded-xl font-semibold hover:bg-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg">
                  Start Chatting with Spirit
                </a>
                <button id="logout-btn" class="bg-red-50 text-red-600 px-8 py-4 rounded-xl font-semibold hover:bg-red-100 transition-colors border border-red-200">
                  Logout
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Features Section -->
      <section class="bg-white py-20">
        <div class="container mx-auto px-6">
          <div class="text-center mb-16">
            <h2 class="text-3xl font-bold text-gray-900 mb-4">
              Spiritual Guidance Features
            </h2>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">
              Experience a deeper connection to faith through Spirit's understanding and guidance
            </p>
          </div>

          <div class="grid md:grid-cols-3 gap-8">
            <!-- Feature 1 -->
            <div class="text-center group">
              <div class="w-16 h-16 bg-purple-100 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:bg-purple-200 transition-colors">
                <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                </svg>
              </div>
              <h3 class="text-xl font-semibold text-gray-900 mb-2">Deep Understanding</h3>
              <p class="text-gray-600">Spirit learns about you personally and understands your unique spiritual journey</p>
            </div>

            <!-- Feature 2 -->
            <div class="text-center group">
              <div class="w-16 h-16 bg-indigo-100 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:bg-indigo-200 transition-colors">
                <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                </svg>
              </div>
              <h3 class="text-xl font-semibold text-gray-900 mb-2">Biblical Wisdom</h3>
              <p class="text-gray-600">Guidance based on Jesus's teachings and Catholic principles</p>
            </div>

            <!-- Feature 3 -->
            <div class="text-center group">
              <div class="w-16 h-16 bg-blue-100 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:bg-blue-200 transition-colors">
                <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
              </div>
              <h3 class="text-xl font-semibold text-gray-900 mb-2">Personal Notes</h3>
              <p class="text-gray-600">Spirit maintains personal notes about your journey and references them in conversations</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Benefits Section -->
      <section class="bg-gradient-to-br from-purple-50 to-indigo-50 py-20">
        <div class="container mx-auto px-6">
          <div class="text-center mb-16">
            <h2 class="text-3xl font-bold text-gray-900 mb-4">
              How Spirit Helps Your Spiritual Journey
            </h2>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">
              Experience spiritual growth through personalized, compassionate guidance
            </p>
          </div>

          <div class="grid md:grid-cols-2 gap-8 max-w-5xl mx-auto">
            <!-- Benefit 1 -->
            <div class="bg-white rounded-2xl p-8 shadow-sm hover:shadow-md transition-shadow">
              <div class="flex items-start space-x-4">
                <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center shrink-0">
                  <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                  </svg>
                </div>
                <div>
                  <h3 class="text-xl font-semibold text-gray-900 mb-2">Scripture-Based Guidance</h3>
                  <p class="text-gray-600">All guidance is rooted in Jesus's teachings and Catholic tradition, helping you grow in faith with wisdom from the Bible</p>
                </div>
              </div>
            </div>

            <!-- Benefit 2 -->
            <div class="bg-white rounded-2xl p-8 shadow-sm hover:shadow-md transition-shadow">
              <div class="flex items-start space-x-4">
                <div class="w-12 h-12 bg-indigo-100 rounded-xl flex items-center justify-center shrink-0">
                  <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                  </svg>
                </div>
                <div>
                  <h3 class="text-xl font-semibold text-gray-900 mb-2">Non-Judgmental Support</h3>
                  <p class="text-gray-600">Spirit responds with warmth, compassion, and empathy - never judgment - meeting you exactly where you are on your journey</p>
                </div>
              </div>
            </div>

            <!-- Benefit 3 -->
            <div class="bg-white rounded-2xl p-8 shadow-sm hover:shadow-md transition-shadow">
              <div class="flex items-start space-x-4">
                <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center shrink-0">
                  <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                  </svg>
                </div>
                <div>
                  <h3 class="text-xl font-semibold text-gray-900 mb-2">Personalized Conversations</h3>
                  <p class="text-gray-600">Spirit remembers your conversations and learns about you, providing increasingly personalized guidance over time</p>
                </div>
              </div>
            </div>

            <!-- Benefit 4 -->
            <div class="bg-white rounded-2xl p-8 shadow-sm hover:shadow-md transition-shadow">
              <div class="flex items-start space-x-4">
                <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center shrink-0">
                  <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                </div>
                <div>
                  <h3 class="text-xl font-semibold text-gray-900 mb-2">Available 24/7</h3>
                  <p class="text-gray-600">Whenever you need spiritual guidance, encouragement, or someone to pray with - Spirit is here for you day or night</p>
                </div>
              </div>
            </div>
          </div>

          <!-- CTA -->
          <div class="text-center mt-16">
            <p class="text-gray-600 mb-6">Start your spiritual journey today</p>
            <a href="/login" class="inline-block bg-purple-600 text-white px-8 py-4 rounded-xl font-semibold hover:bg-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg">
              Begin Conversing with Spirit
            </a>
          </div>
        </div>
      </section>
    </main>

    <script>
      // Set API URL based on current environment
      const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
      const PUBLIC_WORKER_API_URL = isLocalhost
        ? 'http://localhost:8787'
        : 'https://3in1-api.raina.workers.dev';
      // DOM elements
      const loggedOutContent = document.getElementById('logged-out-content');
      const loggedInContent = document.getElementById('logged-in-content');
      const navLoggedOut = document.getElementById('nav-logged-out');
      const navLoggedIn = document.getElementById('nav-logged-in');
      const welcomeText = document.getElementById('welcome-text');
      const logoutBtn = document.getElementById('logout-btn');
      const navLogoutLink = document.getElementById('nav-logout-link');

      // Function to add hidden class
      function hideElement(el) {
        el.classList.add('hidden');
      }

      // Function to remove hidden class
      function showElement(el) {
        el.classList.remove('hidden');
      }

      // Function to check session
      async function checkSession() {
        try {
          const token = localStorage.getItem('session_token');
          if (!token) {
            // Show logged out content
            showElement(loggedOutContent);
            hideElement(loggedInContent);
            showElement(navLoggedOut);
            hideElement(navLoggedIn);
            return;
          }

          const response = await fetch(PUBLIC_WORKER_API_URL + '/auth/validate', {
            headers: {
              'Authorization': 'Bearer ' + token
            }
          });

          if (response.ok) {
            const { user } = await response.json();
            welcomeText.textContent = `Hello, ${user.name}!`;

            // Show logged in content
            hideElement(loggedOutContent);
            showElement(loggedInContent);
            hideElement(navLoggedOut);
            showElement(navLoggedIn);
          } else {
            // Session invalid, clear token
            localStorage.removeItem('session_token');
            // Show logged out content
            showElement(loggedOutContent);
            hideElement(loggedInContent);
            showElement(navLoggedOut);
            hideElement(navLoggedIn);
          }
        } catch (error) {
          console.error('Error checking session:', error);
          // On error, show logged out content
          localStorage.removeItem('session_token');
          showElement(loggedOutContent);
          hideElement(loggedInContent);
          showElement(navLoggedOut);
          hideElement(navLoggedIn);
        }
      }

      // Function to handle logout
      async function handleLogout() {
        try {
          const token = localStorage.getItem('session_token');
          if (token) {
            await fetch(PUBLIC_WORKER_API_URL + '/auth/logout', {
              method: 'POST',
              headers: {
                'Authorization': 'Bearer ' + token,
                'Content-Type': 'application/json'
              }
            });
          }

          localStorage.removeItem('session_token');
          // Update UI to logged out state
          showElement(loggedOutContent);
          hideElement(loggedInContent);
          showElement(navLoggedOut);
          hideElement(navLoggedIn);
        } catch (error) {
          console.error('Error logging out:', error);
        }
      }

      // Add event listeners to logout elements
      logoutBtn.addEventListener('click', handleLogout);
      navLogoutLink.addEventListener('click', function(e) {
        e.preventDefault();
        handleLogout();
      });

      // Check session on page load
      checkSession();
    </script>
</Layout>